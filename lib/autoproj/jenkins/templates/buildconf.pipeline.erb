node {
    stage 'bootstrap'
    <%= render_template('bootstrap.pipeline', vcs: vcs, gemfile: gemfile, autoproj_install_path: autoproj_install_path) %>
    def autoproj = "${pwd()}/dev/.autoproj/bin/autoproj"
    dir('dev') {
        stage 'checkout and update packages'
        sh "${autoproj} update <%= packages.map { |pkg| "'#{pkg.name}'" }.join(" ") %> --force-reset -k"

        stage 'update package jobs and trigger them'
        sh "${autoproj} jenkins update<%= " --dev" if dev %> 'http://localhost:8080' <%= packages.map { |pkg| "'#{pkg.name}'" }.join(" ") %><%= " '--job-prefix=#{job_prefix}'" if !job_prefix.empty? %> --trigger"
    }
}

