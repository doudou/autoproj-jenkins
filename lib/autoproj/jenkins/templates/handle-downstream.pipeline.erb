def downstreamDir = "artifacts/downstream"
def fullPackagePrefix = "${pwd()}/${packagePrefix}"
def targetArtifactPath = "${pwd()}/${downstreamDir}/<%= job_name %>-prefix.zip"

dir(downstreamDir) { deleteDir() }
dir("${downstreamDir}/<%= job_name %>") {
    sh "rsync '${fullPackagePrefix}/' './' -a --delete"
    sh "${autoproj} jenkins relativize ./ '${fullWorkspaceDir}' '@WORKSPACE_ROOT@'"
    zip zipFile: targetArtifactPath, glob: "<%= artifact_glob %>"
}
dir(downstreamDir) {
    archiveArtifacts artifacts: "*.zip"
}

if (triggeredByUser) { // Defined in handle-upstream.pipeline.erb
    <% downstream_jobs.each_key do |job_name| %>
    build job: "<%= job_name %>", wait: false
    <% end %>
}

